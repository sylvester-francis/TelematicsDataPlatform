<div class="vehicle-details-container">
  <!-- Header Section -->
  <section class="vehicle-header glass-card animate-fade-in-up">
    <div class="header-navigation">
      <button mat-icon-button (click)="goBack()" class="back-button">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <div class="breadcrumb">
        <span class="breadcrumb-item">Fleet</span>
        <mat-icon class="breadcrumb-separator">chevron_right</mat-icon>
        <span class="breadcrumb-item active">{{vehicleId}}</span>
      </div>
    </div>
    
    <div class="vehicle-info">
      <div class="vehicle-icon">
        <mat-icon>directions_car</mat-icon>
      </div>
      <div class="vehicle-details">
        <h1 class="vehicle-title">{{vehicleId}}</h1>
        <p class="vehicle-subtitle">Vehicle Telemetry Data</p>
      </div>
      <div class="status-indicator">
        <div class="status-dot active"></div>
        <span class="status-text">Data Available</span>
      </div>
    </div>
  </section>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-state animate-fade-in-up">
    <div class="loading-spinner"></div>
    <div class="loading-text">Loading Vehicle Data</div>
  </div>

  <!-- Main Content -->
  <div *ngIf="!loading">
    
    <!-- Statistics Overview -->
    <section class="stats-section animate-slide-in-right">
      <h2 class="section-title">Vehicle Statistics</h2>
      <div class="stats-grid" *ngIf="vehicleStats">
        
        <div class="stat-card glass-card">
          <div class="stat-header">
            <div class="stat-icon events">
              <mat-icon>analytics</mat-icon>
            </div>
          </div>
          <div class="stat-value">{{vehicleStats.totalEvents | number}}</div>
          <div class="stat-label">Total Events</div>
        </div>

        <div class="stat-card glass-card">
          <div class="stat-header">
            <div class="stat-icon trips">
              <mat-icon>route</mat-icon>
            </div>
          </div>
          <div class="stat-value">{{vehicleStats.activeTrips | number}}</div>
          <div class="stat-label">Active Trips</div>
        </div>

        <div class="stat-card glass-card">
          <div class="stat-header">
            <div class="stat-icon alerts">
              <mat-icon>warning</mat-icon>
            </div>
          </div>
          <div class="stat-value">{{vehicleStats.totalAlerts | number}}</div>
          <div class="stat-label">System Alerts</div>
        </div>

        <div class="stat-card glass-card" *ngIf="vehicleStats.lastKnownSpeed !== null">
          <div class="stat-header">
            <div class="stat-icon speed">
              <mat-icon>speed</mat-icon>
            </div>
          </div>
          <div class="stat-value">{{vehicleStats.lastKnownSpeed | number:'1.1-1'}} km/h</div>
          <div class="stat-label">Last Known Speed</div>
        </div>

      </div>
    </section>

    <!-- Location Information with Map -->
    <section class="location-section animate-fade-in-up" *ngIf="vehicleStats?.lastKnownLatitude && vehicleStats?.lastKnownLongitude">
      <h2 class="section-title">Last Known Location</h2>
      
      <!-- Location Details Card -->
      <div class="location-card glass-card">
        <div class="location-header">
          <div class="location-icon">
            <mat-icon>location_on</mat-icon>
          </div>
          <div class="location-info">
            <div class="location-coords">
              <span class="coord-label">Latitude:</span>
              <span class="coord-value">{{vehicleStats?.lastKnownLatitude | number:'1.6-6'}}</span>
            </div>
            <div class="location-coords">
              <span class="coord-label">Longitude:</span>
              <span class="coord-value">{{vehicleStats?.lastKnownLongitude | number:'1.6-6'}}</span>
            </div>
          </div>
        </div>
        <div class="location-time" *ngIf="vehicleStats?.lastEventTime">
          <mat-icon>schedule</mat-icon>
          <span>Last updated: {{formatDateTime(vehicleStats?.lastEventTime)}}</span>
        </div>
      </div>

      <!-- Interactive Map -->
      <div class="map-card glass-card">
        <div class="map-header">
          <div class="map-title">
            <mat-icon>map</mat-icon>
            <span>Vehicle Location Map</span>
          </div>
        </div>
        <div class="map-container" #mapContainer></div>
      </div>
    </section>

    <!-- Recent Events -->
    <section class="events-section animate-fade-in-up">
      <div class="section-header">
        <h2 class="section-title">Recent Telemetry Events</h2>
        <div class="section-actions">
          <button mat-button (click)="loadVehicleEvents()" class="refresh-btn">
            <mat-icon>refresh</mat-icon>
            <span>Refresh</span>
          </button>
        </div>
      </div>

      <!-- Events Loading -->
      <div *ngIf="eventsLoading" class="events-loading">
        <div class="loading-spinner small"></div>
        <span>Loading events...</span>
      </div>

      <!-- Events List -->
      <div *ngIf="!eventsLoading && events.length > 0" class="events-list-container">
        <div class="events-list">
          <div *ngFor="let event of events" class="event-item glass-card">
            <div class="event-header">
              <span class="event-type-badge" [ngClass]="getEventTypeClass(event.eventType)">
                {{event.eventType}}
              </span>
              <span class="event-timestamp">{{formatDateTime(event.timestamp)}}</span>
            </div>
            <div class="event-details">
              <div class="event-detail" *ngIf="event.speed !== null">
                <span class="detail-label">Speed:</span>
                <span class="detail-value">{{event.speed | number:'1.1-1'}} km/h</span>
              </div>
              <div class="event-detail" *ngIf="event.latitude && event.longitude">
                <span class="detail-label">Location:</span>
                <span class="detail-value coordinates">{{event.latitude | number:'1.4-4'}}, {{event.longitude | number:'1.4-4'}}</span>
              </div>
              <div class="event-detail">
                <span class="detail-label">Status:</span>
                <span class="status-badge" [ngClass]="event.isProcessed ? 'processed' : 'pending'">
                  {{event.isProcessed ? 'Processed' : 'Pending'}}
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- No Events -->
      <div *ngIf="!eventsLoading && events.length === 0" class="no-events">
        <div class="no-events-icon">
          <mat-icon>event_note</mat-icon>
        </div>
        <h3>No Events Found</h3>
        <p>No telemetry events have been recorded for this vehicle yet.</p>
      </div>

    </section>

  </div>

</div>